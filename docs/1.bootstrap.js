(window.webpackJsonp=window.webpackJsonp||[]).push([[1],[,function(e,t,n){const o=document.getElementById("ui"),a=document.getElementById("form"),s=document.getElementById("loading"),c=document.getElementById("file"),l=document.getElementById("start-custom"),i=document.getElementById("start-animation"),r=document.getElementById("antialias"),d=document.getElementById("scale-x"),m=document.getElementById("scale-y"),g=document.getElementById("scale-custom-inputs"),w=document.getElementById("drop-zone"),u=new Worker("worker.js");c.onchange=(()=>{const e=c.files[0],t=(window.URL||window.webkitURL).createObjectURL(e);u.postMessage({url:t}),console.log((new Date).toISOString(),"message sent to worker")}),u.onmessage=(e=>{console.log((new Date).toISOString(),"worker replied");const t=URL.createObjectURL(e.data.blob),n=new Image;n.src=t,n.onload=(()=>{const e=document.getElementById("preview");e&&e.remove(),n.id="preview",n.width>n.height?n.style.width="100px":n.style.height="100px",w.innerHTML="",w.appendChild(n),console.log((new Date).toISOString(),"image loaded"),l.disabled=!1})}),window.ondrop=(e=>{e.preventDefault()}),window.ondragover=(e=>{e.preventDefault(),e.dataTransfer.dropEffect="none"}),w.onclick=(()=>{document.getElementById("file").click()}),w.ondragover=(e=>{console.log(e),e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}),w.ondrop=(e=>{e.stopPropagation(),e.preventDefault();var t=e.dataTransfer.files[0];const n=(window.URL||window.webkitURL).createObjectURL(t);u.postMessage({url:n}),console.log((new Date).toISOString(),"message sent to worker from drop")}),document.form.scale.forEach(e=>{e.onclick=function(){"scale-custom"===this.id?g.classList.remove("display-none"):g.classList.add("display-none")}}),function e(){const t=localStorage.getItem("scale")||"scale-1";document.getElementById(t).checked=!0;"scale-custom"===t&&g.classList.remove("display-none");d.value=localStorage.getItem("scale-x")||1;m.value=localStorage.getItem("scale-y")||1;r.checked="true"===localStorage.getItem("antialias");document.getElementById(localStorage.getItem("powerPreference")||"powerPreference-1").checked=!0;document.getElementById("preview")&&l.classList.remove("display-none");o.classList.remove("display-none");s.classList.add("display-none");const c=new Promise((e,t)=>{l.onclick=(()=>{o.classList.add("display-none"),s.classList.remove("display-none"),setTimeout(()=>{const t=document.getElementById("preview"),n=document.createElement("canvas"),o=n.getContext("2d");n.width=t.width,n.height=t.height,o.drawImage(t,0,0);var a=o.getImageData(0,0,t.width,t.height);e([a])},50)}),i.onclick=(()=>{o.classList.add("display-none"),s.classList.remove("display-none");const t=new Promise((e,t)=>{const n=new Image;n.src="assets/wwix_spritesheet.png",n.onload=(()=>{const t=document.createElement("canvas"),o=t.getContext("2d");t.width=n.width,t.height=n.height,o.drawImage(n,0,0);const a=Math.floor(n.width/256),s=[];for(let e=0;e<45;e++){const t=Math.floor(e/a),n=e%a;s.push(o.getImageData(256*n,224*t,256,224))}e(s)}),n.onerror=(e=>t(e))});t.then(e)})});c.then(t=>{console.log((new Date).toISOString(),"image readed");const o=window.devicePixelRatio,c=window.screen.width,l=window.screen.height,i=a.querySelector('input[name="scale"]:checked');let d=1,m=1;localStorage.setItem("scale",i.id),"scale-custom"==i.id?(d=document.getElementById("scale-x").value,m=document.getElementById("scale-y").value,localStorage.setItem("scale-x",d),localStorage.setItem("scale-y",m)):d=i.value;const g=document.createElement("canvas");g.width=c*o,g.height=l*o,g.style.width=c,g.style.height=l,document.body.appendChild(g);const w=a.querySelector('input[name="powerPreference"]:checked'),u={alpha:!0,antialias:r.checked,depth:!0,failIfMajorPerformanceCaveat:!1,powerPreference:w.value,premultipliedAlpha:!1,preserveDrawingBuffer:!1,stencil:!1};localStorage.setItem("antialias",u.antialias?"true":"false"),localStorage.setItem("powerPreference",w.id),console.log("gl context form",u);const h=g.getContext("webgl2",u);var p=document.documentElement;if(p.requestFullscreen=p.requestFullscreen||p.webkitRequestFullScreen||p.mozRequestFullScreen||p.msRequestFullscreen,g.onmousedown=(e=>{1==e.buttons&&(g.requestPointerLock(),window.screen.width!=window.innerWidth&&window.screen.height!=window.innerHeight&&p.requestFullscreen())}),window.addEventListener("exit_pointer_lock",()=>{document.exitPointerLock()},!1),window.addEventListener("exiting_session",()=>{e(),g.remove()},!1),g.requestPointerLock=g.requestPointerLock||g.mozRequestPointerLock,document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock,!h)throw new Error("Could not get webgl context.");n.e(2).then(n.bind(null,2)).then(e=>{const n=new e.Animation_Source(t[0].width,t[0].height,c,l,1/60,+d,+m);for(let e=0;e<t.length;e++){const o=t[e];n.add(o.data.buffer)}console.log((new Date).toISOString(),"calling wasm main"),e.main(h,n),console.log((new Date).toISOString(),"wasm main done"),s.classList.add("display-none")})})}()}]]);