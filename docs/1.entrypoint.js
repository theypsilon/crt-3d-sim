(window.webpackJsonp=window.webpackJsonp||[]).push([[1],[,function(e,t,n){const o=document.getElementById("ui"),a=document.getElementById("form"),d=document.getElementById("loading"),i=document.getElementById("file"),s=document.getElementById("start-custom"),l=document.getElementById("start-animation"),c=document.getElementById("antialias"),r=document.getElementById("scale-x"),m=document.getElementById("scale-y"),u=document.getElementById("scale-custom-inputs"),p=document.getElementById("drop-zone"),g=document.getElementById("info-hide"),w=document.getElementById("info-panel"),h=document.getElementById("fps-counter"),y=document.getElementById("camera-pos-x"),v=document.getElementById("camera-pos-y"),E=document.getElementById("camera-pos-z"),I=document.getElementById("camera-dir-x"),L=document.getElementById("camera-dir-y"),f=document.getElementById("camera-dir-z"),B=document.getElementById("camera-axis-up-x"),x=document.getElementById("camera-axis-up-y"),M=document.getElementById("camera-axis-up-z"),k=document.getElementById("pixel-scale-x"),P=document.getElementById("pixel-scale-y"),S=document.getElementById("pixel-gap");function T(){const e=localStorage.getItem("scale")||"scale-1";document.getElementById(e).checked=!0,"scale-custom"===e&&u.classList.remove("display-none"),r.value=localStorage.getItem("scale-x")||1,m.value=localStorage.getItem("scale-y")||1,c.checked="true"===localStorage.getItem("antialias"),document.getElementById(localStorage.getItem("powerPreference")||"powerPreference-1").checked=!0,document.getElementById("preview")&&s.classList.remove("display-none"),o.classList.remove("display-none"),d.classList.add("display-none"),new Promise((e,t)=>{s.onclick=(()=>{o.classList.add("display-none"),d.classList.remove("display-none"),setTimeout(()=>{const t=document.getElementById("preview"),n=document.createElement("canvas"),o=n.getContext("2d");n.width=t.width,n.height=t.height,o.drawImage(t,0,0);var a=o.getImageData(0,0,t.width,t.height);e([a])},50)}),l.onclick=(()=>{o.classList.add("display-none"),d.classList.remove("display-none"),new Promise((e,t)=>{const n=new Image;n.src="assets/wwix_spritesheet.png",n.onload=(()=>{const t=document.createElement("canvas"),o=t.getContext("2d");t.width=n.width,t.height=n.height,o.drawImage(n,0,0);const a=Math.floor(n.width/256),d=[];for(let e=0;e<45;e++){const t=e%a,n=Math.floor(e/a);d.push(o.getImageData(256*t,224*n,256,224))}e(d)}),n.onerror=(e=>t(e))}).then(e)})}).then(e=>{console.log((new Date).toISOString(),"image readed");const t=window.devicePixelRatio,o=window.screen.width,i=window.screen.height,s=a.querySelector('input[name="scale"]:checked');let l=1,r=1;localStorage.setItem("scale",s.id),"scale-custom"==s.id?(l=document.getElementById("scale-x").value,r=document.getElementById("scale-y").value,localStorage.setItem("scale-x",l),localStorage.setItem("scale-y",r)):l=s.value;const m=document.createElement("canvas");m.id="gl-canvas",m.width=o*t,m.height=i*t,m.style.width=o,m.style.height=i,w.style.setProperty("max-height",i-50),document.body.appendChild(m);const u=a.querySelector('input[name="powerPreference"]:checked'),p={alpha:!0,antialias:c.checked,depth:!0,failIfMajorPerformanceCaveat:!1,powerPreference:u.value,premultipliedAlpha:!1,preserveDrawingBuffer:!1,stencil:!1};localStorage.setItem("antialias",p.antialias?"true":"false"),localStorage.setItem("powerPreference",u.id),console.log("gl context form",p);const g=m.getContext("webgl2",p);var h=document.documentElement;if(h.requestFullscreen=h.requestFullscreen||h.webkitRequestFullScreen||h.mozRequestFullScreen||h.msRequestFullscreen,m.onmousedown=(e=>{1==e.buttons&&(m.requestPointerLock(),window.screen.width!=window.innerWidth&&window.screen.height!=window.innerHeight&&h.requestFullscreen())}),m.requestPointerLock=m.requestPointerLock||m.mozRequestPointerLock,document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock,!g)throw new Error("Could not get webgl context.");n.e(2).then(n.bind(null,2)).then(t=>{const n=new t.Animation_Source(e[0].width,e[0].height,o,i,1/60,+l,+r);for(let t=0;t<e.length;t++){const o=e[t];n.add(o.data.buffer)}console.log((new Date).toISOString(),"calling wasm main"),t.main(g,n),console.log((new Date).toISOString(),"wasm main done"),d.classList.add("display-none"),w.classList.remove("display-none")})})}async function b(e){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="blob",t.send(null),await new Promise(e=>t.onload=(()=>e()));const n=URL.createObjectURL(t.response),o=new Image;o.src=n,await new Promise(e=>o.onload=(()=>e()));const a=document.getElementById("preview");a&&a.remove(),o.id="preview",o.width>o.height?o.style.width="100px":o.style.height="100px",p.innerHTML="",p.appendChild(o),console.log((new Date).toISOString(),"image loaded"),s.disabled=!1}window.ondrop=(e=>{e.preventDefault()}),window.ondragover=(e=>{e.preventDefault(),e.dataTransfer.dropEffect="none"}),window.addEventListener("app-event.toggle_info_panel",()=>{document.getElementById("gl-canvas")&&(w.classList.contains("display-none")?w.classList.remove("display-none"):(w.classList.add("display-none"),window.dispatchEvent(new CustomEvent("app-event.top_message",{detail:"Toggle the Info Panel by pressing SPACE."}))))},!1),window.addEventListener("app-event.exit_pointer_lock",()=>{document.exitPointerLock()},!1),window.addEventListener("app-event.exiting_session",()=>{T(),document.getElementById("gl-canvas").remove(),w.classList.add("display-none")},!1),window.addEventListener("app-event.fps",e=>{h.innerHTML=Math.round(e.detail)},!1),window.addEventListener("app-event.top_message",e=>{const t=document.getElementById("top-message");t&&t.remove();const n=document.createElement("div");n.id="top-message";const o=document.createElement("span");o.innerHTML=e.detail,n.appendChild(o),document.body.appendChild(n);let a=.75;n.style.opacity=a,setTimeout(()=>{!function e(){a>=.01?(a-=.01,n.style.opacity=a,setTimeout(e,16)):n.remove()}()},1e3)},!1),window.addEventListener("app-event.camera_update",e=>{y.innerHTML=Math.round(100*e.detail[0])/100,v.innerHTML=Math.round(100*e.detail[1])/100,E.innerHTML=Math.round(100*e.detail[2])/100,I.innerHTML=Math.round(100*e.detail[3])/100,L.innerHTML=Math.round(100*e.detail[4])/100,f.innerHTML=Math.round(100*e.detail[5])/100,B.innerHTML=Math.round(100*e.detail[6])/100,x.innerHTML=Math.round(100*e.detail[7])/100,M.innerHTML=Math.round(100*e.detail[8])/100},!1),window.addEventListener("app-event.change_pixel_scale_x",e=>{k.innerHTML=Math.round(1e3*e.detail)/1e3},!1),window.addEventListener("app-event.change_pixel_scale_y",e=>{P.innerHTML=Math.round(1e3*e.detail)/1e3},!1),window.addEventListener("app-event.change_pixel_gap",e=>{S.innerHTML=Math.round(1e3*e.detail)/1e3},!1),g.onclick=(()=>{document.getElementById("gl-canvas")&&(w.classList.add("display-none"),window.dispatchEvent(new CustomEvent("app-event.top_message",{detail:"Show the Info Panel again by pressing SPACE."})))}),i.onchange=(()=>{const e=i.files[0];b((window.URL||window.webkitURL).createObjectURL(e))}),p.onclick=(()=>{document.getElementById("file").click()}),p.ondragover=(e=>{e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}),p.ondrop=(e=>{e.stopPropagation(),e.preventDefault();var t=e.dataTransfer.files[0];b((window.URL||window.webkitURL).createObjectURL(t))}),document.form.scale.forEach(e=>{e.onclick=function(){"scale-custom"===this.id?u.classList.remove("display-none"):u.classList.add("display-none")}}),T()}]]);