<html>
<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-128249288-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-128249288-1');
  </script>
  <title>CRT 3D Sim</title>
  <link rel="stylesheet" href="style.css">
  <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
</head>
<body>
  <img id="loading" src="assets/Loading_icon.gif">
  <link rel="stylesheet" href="bootstrap.min.css">
  <link rel="stylesheet" href="bootstrap-theme.min.css">
  <link rel="stylesheet" href="theme.css">

  <section id="ui" class="display-none">
    <a href="https://github.com/theypsilon/crt-3d-sim">
      <img id="fork-me" src="assets/forkme.png" alt="Fork me on GitHub">
    </a>

    <header class="container bg-white jumbotron page-header">
      <h1 class="margin-sm-bottom">CRT 3D Sim</h1>
      <div class="row">
        <div class="col-md-6 col-sm-12 margin-sm-bottom">
          <p>This tool is a proof of concept of a sandbox to create filters that mitigate the unrealistic experience of watching content designed for old CRTs in modern LCD screens.</p>
        </div>
        <div class="col-md-4 col-md-offset-2 col-sm-12 text-center">
          <p>Don't get why this is a thing?</p>
          <a class="btn btn-crt btn-green text-white" href="#explanation">Read some explanation below</a>
        </div>
      </div>
    </header>

    <section class="warning bg-warning text-white">
      <div class="container text-center">
        <p class="text-big spacing-md"><strong>WARNING! Mobile devices won't work!</strong></p>
        <p>You need a PC with NVIDIA or ATI graphics card with updated drivers<br> and a modern browser (but not Edge) in order to run this without problems.</p>
      </div>
    </section>

    <section class="bg-green text-white form">
      <form class="container" id="form" name="form">
        <div class="render-tests row">
          <div class="render-panel-dad col-sm-6 margin-sm-bottom">
            <h3>Render test animation</h3>
            <div class="well render-panel">
              <div class="gif bg-white"><img src="assets/wwix.gif"><span>256 ✕ 224</span></div><br/>
              <input id="start-animation" class="start btn-crt btn-white" type="button" value="Launch">
            </div>
          </div>
          <div class="render-panel-dad col-sm-6">
            <h3>Render image from your disk</h3>
            <div class="well render-panel">
              <input type="file" id="file" class="display-none" accept="image/*">
              <div id="drop-zone">
                <div id="drop-zone-text" class="text-white">drop an image file here or click to upload it</div>
                <div class="display-none text-white" id="preview-size-elements">
                  <div class="preview-size" id="preview-width">256</div>
                  <div class="preview-size">✕</div>
                  <div class="preview-size" id="preview-height">224</div>
                </div>
              </div>
              <input id="start-custom" class="start btn-crt btn-white" type="button" value="Launch" title="You need to have an image first" disabled>
            </div>
          </div>
        </div>
        <div>
          <h3>Options</h3>
          <div class="options">
            <div class="option-inputs">
              <label class="block">WebGl Context:</label>
              <div class="option-inputs">
                <label for="antialias">antialias:</label>
                <input type="checkbox" id="antialias" value="antialias">
              </div>

              <div class="option-inputs">
                <label class="margin-left">powerPreference:</label>
                <input type="radio" id="powerPreference-1" name="powerPreference" value="default" /><div class="option-text">default</div>
                <input type="radio" id="powerPreference-2" name="powerPreference" value="high-performance" /><div class="option-text">high-performance</div>
                <input type="radio" id="powerPreference-3" name="powerPreference" value="low-power" /><div class="option-text">low-power</div>
              </div>
            </div>
            <div class="option-inputs">
              <label class="block">Scaling:</label>
              <div class="scaling-radio" title="Auto detect">
                <input type="radio" id="scaling-auto" name="scaling" value="0" />
                <div class="option-text">auto detect</div>
              </div>
              <div class="scaling-radio" title="None"><input type="radio" id="scaling-none" name="scaling" value="1" /><div class="option-text">none</div></div>
              <div class="scaling-radio" title="4:3 on full image"><input type="radio" id="scaling-4:3" name="scaling" value="-1" /><div class="option-text">4:3 on full image</div></div>
              <div class="scaling-radio" title="Stretch to both edges"><input type="radio" id="scaling-stretch-both" name="scaling" /><div class="option-text">stretch to both edges</div></div>
              <div class="scaling-radio" title="Stretch to nearest edge, keeps proportions"><input type="radio" id="scaling-stretch-nearest" name="scaling" /><div class="option-text">stretch to nearest edge</div></div>
              <div class="scaling-radio" title="Introduce the values yourself"><input type="radio" id="scaling-custom" name="scaling" /><div class="option-text">custom</div></div>
              <div id="scaling-custom-inputs" class="option-inputs display-none">
                <label for="scaling-custom">Custom Scaling:</label>
                <div class="option-inputs">
                  <label>background resolution:</label>
                  <input class="custom-resolution" type="number" id="scaling-custom-resolution-width" value="256" min="1" max="99999">
                  <span>✕</span>
                  <input class="custom-resolution" type="number" id="scaling-custom-resolution-height" value="224" min="1" max="99999">
                  <input class="display-none" type="button" value="Set to " id="scaling-custom-resolution-button" title="Set it to fit the uploaded image">
                </div>
                <div class="option-inputs">
                  <label>aspect ratio:</label>
                  <input class="custom-aspect-ratio" type="number" id="scaling-custom-aspect-ratio-x" value="4" min="1" max="99">
                  <span>:</span>
                  <input class="custom-aspect-ratio" type="number" id="scaling-custom-aspect-ratio-y" value="3" min="1" max="99">
                </div>
                <div class="option-inputs">
                  <label>stretch to nearest edge:</label>
                  <input class="custom-checkbox" type="checkbox" id="scaling-custom-stretch-nearest">
                </div>
              </div>
            </div>
            <input class="btn btn-crt btn-white pull-right" type="button" id="restore-default-options" value="Restore defaults">
          </div>
        </div>
      </form>
    </section>

    <section class="container explanation">
      <h3>Explanation:</h3>
      <a name="explanation"></a>
      <p>Old systems, like the NES, SNES, or Mega Drive, did usually work with resolutions such as 256x224 or 320x224 that would be deformed to fit a 4:3 screen. Graphics were designed with this aspect ratio transformation in mind. Therefore, when scaling them up by multiplying the original resolution by a given integer factor, those graphics are distorted if not using some sort of filtering for that matter. Stretching the images to fit a 4:3 aspect ratio within the current resolution also gives distortion as result, because of pixel interpolation, but is usually a preferred solution.</p>
      <p>Another issue is that the CRTs didn't render perfectly adyacent and squared pixels. This also alters heavily the perception of old graphics, which in today screens are looking too sharp, and in some cases just plain bad. Pre-rendered sprites are specially affected by this, but in general, the original charm is lost in translation.</p>
      <p>In order to preserve the CRT-era content, lots of work have been done in filters. They work usually by blending pixels and introducing gaps and effects. And they can be quite good, but there is still a significant amount of progress to be done in order to get closer to the original look.</p>
      <p>This project tries to experiment in a 3D space where every pixel is a 3D object. This is an approach that I haven't seen so far, so I had to give it a try. Right now, pixels can be cubes and squares, but it's the goal of this tool to explore new shapes and lighting properties.</p>
      <p>With the given controls, it's easy to recreate a simple scanlines filter. But the current resolutions seem to be a limitating factor as of now. The results are noticeably better in higher resolutions, such as 4k, which is the one I use the most during testing.</p>
      <p>The tool renders automatically in your current screen resolution. Computing cost is heavy, so a good GPU is needed to work with high screen resolutions and high resolution images. I recommend you to upload 256x224 pictures, which is the original use case I intended to cover. Here you got a <a href="https://www.google.com/search?q=snes&biw=1853&bih=950&tbm=isch&source=lnt&tbs=isz:ex,iszw:256,iszh:224">link</a> with plenty of pictures of this kind. Keep in mind the scaling options you can select above, to fix the aspect ratio missmatches when working with other retro system with special screens (like the Game Boy).</p>
    </section>

    <footer class="clear text-white bg-footer">
      <div class="container">
        <h3>Credits</h3>
        <div class="row">
          <div class="col-sm-4 margin-sm-bottom">
            <label>Concept + Implementation</label><p>José Manuel Barroso Galindo<br>&lt;theypsilon@gmail.com&gt;</p>
          </div>
          <div class="col-sm-4 margin-sm-bottom">
            <label>Test animation sprites</label><p>Ryoga<br>&lt;pig_saint@gmail.com&gt;</p>
          </div>
          <div class="col-sm-4 margin-sm-bottom">
            <label>Front-end Designer</label><p>Ana Manosfrias<br>&lt;a.gilamor@gmail.com&gt;</p>
          </div>
        </div>
      </div>
    </footer>
  </section>

  <section id="info-panel" class="display-none">
    <div id="fps-counter-holder"><div id="fps-counter"></div><span>FPS</span></div>
    <h3>Sim Panel</h3>
    <div class="info-category">
      <div><h5>Camera Movements <div id="reset-camera" class="reset-button"><button class="activate-button" title="All camera parameters will be reset.">Reset Position</button></div></h5></div>
        <div id="camera-right-panel">
          <div id="camera-movement-indicator">
          <div class="camera-field-header"><div class="camera-coordinate">X</div><div class="camera-coordinate">Y</div><div class="camera-coordinate">Z</div></div>
          <div id="camera-pos" class="camera-field-group">
            <div class="camera-field-name">pos:</div>
            <input id="camera-pos-x" class="camera-field camera-field-left" type="number" step="0.01"/>
            <input id="camera-pos-y" class="camera-field camera-field-center" type="number" step="0.01"/>
            <input id="camera-pos-z" class="camera-field camera-field-right" type="number" step="0.01"/>
          </div>
          <div id="camera-dir" class="camera-field-group">
            <div class="camera-field-name">dir:</div>
            <input id="camera-dir-x" class="camera-field camera-field-left camera-field-mid" type="number" step="0.01"/>
            <input id="camera-dir-y" class="camera-field camera-field-center camera-field-mid" type="number" step="0.01"/>
            <input id="camera-dir-z" class="camera-field camera-field-right camera-field-mid" type="number" step="0.01"/>
          </div>
          <div id="camera-axis-up" class="camera-field-group">
            <div class="camera-field-name">axis:</div>
            <input id="camera-axis-up-x" class="camera-field camera-field-left" type="number" step="0.01"/>
            <input id="camera-axis-up-y" class="camera-field camera-field-center" type="number" step="0.01"/>
            <input id="camera-axis-up-z" class="camera-field camera-field-right" type="number" step="0.01"/>
          </div>
        </div>
        <ul title="Zoom Hotkeys: Mouse wheel up & down"><li><div class="feature-name">· Zoom:</div><br><div id="camera-zoom-parent" class="feature-value"><input id="camera-zoom" class="number-input feature-modificable-input" type="number" placeholder="0" step="1" min="1" max="45" value="0"></div></li></ul>
      </div>
      <ul>
        <li><div class="feature-name">· Translation:</div><br><div id="feature-camera-movements" class="camera-movements-arrows">
          <div><button class="activate-button feature-movement-keys key-up-center">W</button><button class="activate-button feature-movement-keys key-up-far-right">Q</button> ↑</div><br/>
          <div><button class="activate-button feature-movement-keys">A</button><button class="activate-button feature-movement-keys key-down-center">S</button><button class="activate-button feature-movement-keys">D</button><button class="activate-button feature-movement-keys key-down-far-right">E</button> ↓</div>
        </div></li>
        <li style="height: 65px"><div class="feature-name">· Rotation:</div><br><div id="feature-camera-turns" class="camera-movements-arrows">
          <div><button class="activate-button feature-movement-keys key-up-center">↑</button><button class="activate-button feature-movement-keys key-up-far-right">+</button> ⟳</div><br/>
          <div><button class="activate-button feature-movement-keys">←</button><button class="activate-button feature-movement-keys key-down-center">↓</button><button class="activate-button feature-movement-keys">→</button><button class="activate-button feature-movement-keys key-down-far-right">-</button> ⟲</div>
        </div></li>
      </ul>
    </div>
    <div class="info-category">
      <h5>Screen Filter Options <div id="reset-filters" class="reset-button"><button class="activate-button" title="All screen filter options will be reset.">Reset Filters</button></div></h5>
      <ul class="info-options">
        <li title="Horizontal gap Hotkeys: J & K"><div><div class="feature-name">Horizontal gap</div><sup class="feature-hotkeys">(J, K)</sup></div><div class="feature-value"><input id="pixel-horizontal-gap" class="number-input feature-modificable-input" type="number" placeholder="0" step="0.001" min="0" max="10" value="0"></div></li>
        <li title="Vertical gap Hotkeys: U & I"><div><div class="feature-name">Vertical gap</div><sup class="feature-hotkeys">(U, I)</sup></div><div class="feature-value"><input id="pixel-vertical-gap" class="number-input feature-modificable-input" type="number" placeholder="0" step="0.001" min="0" max="10" value="0"></div></li>
        <li title="Width Hotkeys: N & M"><div><div class="feature-name">Pixel width</div><sup class="feature-hotkeys">(N, M)</sup></div><div class="feature-value"><input id="pixel-width" class="number-input feature-modificable-input" type="number" placeholder="0" step="0.001" min="0" max="10" value="0"></div></li>
        <li title="Lines per Pixel Hotkeys: G & H"><div><div class="feature-name">Lines per Pixel</div><sup class="feature-hotkeys">(G, H)</sup></div><div class="feature-value"><input id="lines-per-pixel" class="number-input feature-modificable-input" type="number" placeholder="0" step="1" min="0" max="100" value="0"></div></li>
        <li title="Blur Level Hotkeys: B & V"><div><div class="feature-name">Blur level</div><sup class="feature-hotkeys">(B, V)</sup></div><div class="feature-value"><input id="blur-level" class="number-input feature-modificable-input" type="number" placeholder="0" step="1" min="0" max="100" value="0"></div></li>
        <li><div class="feature-name">Source light color  </div><div><input class="feature-button" id="light-color" type="color" value="#ffffff"></div></li>
        <li title="Brightness Hotkeys: C & X"><div><div class="feature-name">Brigthness</div><sup class="feature-hotkeys">(C, X)</sup></div><div class="feature-value"><input id="pixel-brightness" class="number-input feature-modificable-input" type="number" placeholder="0" step="0.001" min="-1" max="1" value="0"></div></li>
        <li title="Contrast Hotkeys: &lt; & Z"><div><div class="feature-name">Contrast</div><sup class="feature-hotkeys">(&lt;, Z)</sup></div><div class="feature-value"><input id="pixel-contrast" class="number-input feature-modificable-input" type="number" placeholder="0" step="0.001" min="0" max="20" value="1"></div></li>
        <li title="Color representation Hotkeys: Y"><div><div class="feature-name">Color representation type</div><sup class="feature-hotkeys">(Y)</sup></div><div><input class="number-input feature-readonly-input" id="feature-change-color-representation" type="text" value="0" disabled></div></li>
        <li title="Pixel geometry Hotkeys: O"><div><div class="feature-name">Pixel geometry type</div><sup class="feature-hotkeys">(O)</sup></div><div><input class="number-input feature-readonly-input" id="feature-change-pixel-geometry" type="text" value="0" disabled></div></li>
        <li title="Screen curvature type Hotkeys: L"><div><div class="feature-name">Screen curvature type</div><sup class="feature-hotkeys">(L)</sup></div><div><input class="number-input feature-readonly-input" id="feature-change-screen-curvature" type="text" value="0" disabled></div></li>
        <li title="Pixel shadow shape Hotkeys: ."><div><div class="feature-name">Pixel shadow shape</div><sup class="feature-hotkeys">(.)</sup></div><div><input class="number-input feature-readonly-input" id="feature-change-pixel-shadow-shape" type="text" value="0" disabled></div></li>
        <li title="Pixel shadow hybrid height Hotkeys: None"><div><div class="feature-name">Pixel shadow hybrid height</div><sup class="feature-hotkeys"></sup></div><div><input class="number-input feature-modificable-input" id="feature-change-pixel-shadow-height" type="number" placeholder="0" step="0.001" min="0" max="1" value="0"></div></li>
        <li title="Internal Resolution Hotkeys: None"><div><div class="feature-name">Internal Resolution</div><sup class="feature-hotkeys"></sup></div><div><input class="number-input feature-readonly-input" id="feature-internal-resolution" type="text" disabled></div></li>
        <li title="Texture Interpolation Hotkeys: None"><div><div class="feature-name">Texture Interpolation</div><sup class="feature-hotkeys"></sup></div><div><input class="number-input feature-readonly-input" id="feature-texture-interpolation" type="text" disabled></div></li>
        <li title="Screen layering type Hotkeys: ,"><div><div class="feature-name">Screen layering type</div><sup class="feature-hotkeys">(,)</sup></div><div><input class="number-input feature-readonly-input" id="feature-change-screen-layering-type" type="text" value="0" disabled></div></li>
        <li title="Pixel spread Hotkeys: Shift+N & Shift+M" class="display-none"><div><div class="feature-name">Pixel Spread</div><sup class="feature-hotkeys">(Shift+N, Shift+M)</sup><div class="feature-value"><input id="pixel-spread" class="number-input feature-modificable-input" type="number" placeholder="0" step="0.001" min="0" max="10" value="0"></div></div></li>
        <li class="display-none"><div><div class="feature-name">Brightness color</div></div><div><input class="feature-button" id="brightness-color" type="color" value="#ffffff"></div></li>
      </ul>
    </div>
    <div class="info-category">
      <h5>Velocity <div id="reset-speeds" class="reset-button"><button class="activate-button" title="All speed parameters will be reset. Hotkey: T">Reset Speeds</button></div></h5>
      <ul class="info-options">
        <li title="Camera speed Hotkeys: F & R"><div><div class="feature-name">Camera speed</div><sup class="feature-hotkeys">(F, R)</sup></div><div class="feature-value"><input id="feature-change-move-speed" class="number-input feature-readonly-input" type="text" disabled></div></li>
        <li title="Filter speed Hotkeys: Shift+F & Shift+R"><div><div class="feature-name">Filter speed</div><sup class="feature-hotkeys">(Shift+F, Shift+R)</sup></div><div class="feature-value"><input id="feature-change-pixel-speed" class="number-input feature-readonly-input" type="text" disabled></div></li>
        <li title="Turn speed Hotkeys: Alt+F & Alt+R" class="display-none"><div><div class="feature-name">Turn speed</div><sup class="feature-hotkeys">(Alt+F, Alt+R)</sup></div><div class="feature-value"><input id="feature-change-turn-speed" class="number-input feature-readonly-input" type="text" disabled></div></li>
      </ul>
    </div>
    <div class="info-button">
        <input title="Hotkey: ESC" class="btn btn-crt btn-green text-white" id="feature-quit" type="button" value="Quit simulation">
    </div>
    <br>
    <div class="info-button">
      <input title="Hotkey: SPACE" class="btn btn-crt btn-green text-white" id="info-hide" type="button" value="Hide this panel">
    </div>
  </section>
</body>
</html>